<style scoped>
  #index{
    margin-bottom: 0!important;
  }
  .swiper-container{
    height: 7.25rem!important;
  }
  .swiper-slide {
    background-repeat: no-repeat;
    background-size: 100% 4.48rem;
  }
  .exchange .aui-list-item-media{
    width: 2.56rem;
    height: 2.56rem;
    padding: 0;
    margin-right: 0.533rem;
  }
  .exchange .aui-list-item{
    padding: 0.64rem 0.64rem 0.64rem 0;
    margin-left: 0.64rem;
  }
  /*轮播图外层*/
  .swiperbox{
    overflow: hidden;
    position: relative;
  }
  /*轮播右下角*/
  .picLogo{
    width: 1.706rem;
    height: 0.853rem;
    position: absolute;
    right: 0.64rem;
    bottom: 0.512rem;
    z-index: 200;
    color: #fff;
    font-size: 0.533rem;
  }
  .imgPic{
    width: 0.853rem;
    height: 0.746rem;
    background: url(../../assets/shopmall/image.png);
    background-size: 100%;
    background-repeat: no-repeat;
    margin-right: 0.426rem;
    float: left;
  }
  /*买单*/
  .check{
    width: 100%;
    position: absolute;
    top: 7.72rem;
    background: #fff;
    padding: 0.96rem 0.64rem 0.64rem;
  }
  .check .checkTitle{
    font-size: 0.853rem;
    color: #000000;
    font-weight: 700;
  }
  /*小星星*/
  .storeStart{
    margin-top: 0.64rem;
    font-size: 0.533rem;
    color: #f5a623;
  }
  .storeStart span{
    margin-left: 0.426rem;
    line-height: 100%;
  }
  .storeStart .start{
    width: 0.64rem;
    height: 0.64rem;
    float: left;
    margin-right: 0.106rem;
    background-image: url(../../assets/shopmall/starsss.png);
    background-size: 100%;
  }
  .storeStart .start1{
    background-image: url(../../assets/shopmall/start0.png);
    background-size: 100%;
  }
  /*消费  营业时间*/
  .storedata,.storeTime{
  font-size: 0.576rem;
  color: #999999;
  margin-top: 0.426rem;
 }
 .storedata .renjun{
  margin-right: 0.853rem;
 }
.introduce{
  padding: 0.9rem 0.64rem 0.533rem;
  background: #fff;
  overflow: hidden;
}
.buyBtn{
  width: 4.266rem;
  line-height: 1.706rem;
  background: #ff393a;
  text-align: center;
  color: #fff;
  font-size: 0.64rem;
  position: absolute;
  right: 0.64rem;
  top: 2.773rem;
}
 .storebr{
  width: 100%;
  height: 0.05rem;
  background: #eeeeee;
  margin-top: 0.853rem;
 }
 .introduce .storebr{
  margin-top: 0;
 }
 /*地址*/
 .introduce .address{
  width: 81.1%;
  padding-left: 0.96rem;
  background-image: url(../../assets/shopmall/dizhi.png);
  background-repeat: no-repeat;
  background-position:0 0.32rem;
  background-size: 0.533rem 0.64rem;
  font-size: 0.533rem;
  padding-top: 0.15rem;
  border-right:0.03rem solid #eeeeee;
  float: left;
 }
 .introduce .address p{
  color: #333333;
 }
.introduce  .phone{
  width: 18.9%;
  min-height: 2.133rem;
  height: 100%;
  float: left;
  background-image: url(../../assets/shopmall/phone.png);
  background-repeat: no-repeat;
  background-position: center;
  background-size: 1.066rem;
}
/*店铺特色*/
.characteristic{
  margin-top: 0.64rem;
  padding: 0.853rem 0.64rem;
  background: #fff;
}
.characteristic .characteristicTxt{
  font-size: 0.64rem;
  text-align: center;
  color: #333333;
}
.characteristic .heng{
  width: 1.28rem;
  height: 0.213rem;
  background: #cccccc;
  border-radius: 0.213rem;
  margin: 0.213rem auto;
}
  .characteristicCon{
    font-size: 0.64rem;
    color: #333333;
    padding-left: 0.64rem;
    position: relative;
    margin-top: 0.64rem;
  }
  .characteristicCon::after{
    content: '';
    position:absolute;
    width: 0.213rem;
    height: 0.213rem;
    left: 0;
    top: 50%;
    margin-top: -0.1065rem;
    border-radius: 0.213rem;
    background: #666666;
  }
  /*评论*/
  .comment{
    margin-top: 0.64rem;
    padding: 0.64rem;
    background: #fff;
  }
  .comment .commentNum{
    float: right;
    margin-right: 0.64rem;
    margin-top: 0.1rem;
    color: #999999;
  }
  .comment .commentZong{
    position: relative;
    overflow: hidden;
  }
  .comment .commentZong::after,.discount::after{
    content: '';
    width: 0.32rem;
    height: 0.32rem;
    position: absolute;
    top: 50%;
    right: 0.1rem;
    margin-top: -0.32rem;
    background: transparent;
    border: 1px solid #dddddd;
    border-top: none;
    border-right: none;
    z-index: 2;
    -webkit-border-radius: 0;
    border-radius: 0;
    -webkit-transform: rotate(-135deg);
    transform: rotate(-135deg);
  }
  .comment .storeStart{
    margin-top: 0;
  }
  /*评论*/
  .aui-card-list-header,.aui-card-list-content-padded{
    padding-left: 0;
    padding-right: 0;
  }
  .aui-card-list-content-padded{
    color: #666;
  }
  .aui-row-padded{
    padding: 0;
  }
  .aui-row-padded .aui-col-xs-4{
    width: 3.512rem;
    height: 3.512rem;
    background-size: cover;
    background-position: center;
    margin-right: 0.298rem;
  }
  .aui-row-padded .aui-col-xs-4:last-child{
    margin-right: 0;
  }
.comment .aui-text-info{
  font-size: 0.64rem;
  color: #333!important;
}
.comment .aui-card-list-user-avatar{
  width: 1.92rem;
}
/*查看评论*/
.seebtn{
  width: 100%;
  line-height: 1.706rem;
  font-size: 0.533rem;
  color: #999999;
  text-align: center;
  background: #fff;
  padding:0 0.64rem;
  display: block;
}

.storebr.dizhi,.seebtn .storebr{
  margin-top: 0;
}
.storebr.dizhi{
  margin-top: 7.25rem;
  z-index: 600;
}
/*联系电话弹窗*/
.rodiasex{
  position:fixed;
  width: 100%;
  height: 100%;
  top: 0;
  background: rgba(0,0,0,.8); 
  z-index: 200;

}
.sexs{
  z-index: 500;
  position: absolute;
  top: 50%;
  margin-top: -5rem;
  left: 50%;
  margin-left: -6rem;
  background: #fff;  
  width: 12rem;
  height: 6rem;
  border-radius: .3rem;
    overflow: hidden;
}
.sexTitle{
  line-height: 2rem;
  text-align: center;
}
label{
  margin: 2rem;
}
/*按钮组*/
.btnsArr{
  width: 100%;
  height: 2.2rem;
  position: absolute;
  bottom: 0;
  border-top: 0.03rem solid #eee;
}
.btnsArr div{
  width: 50%;
  float: left;
  line-height: 2.2rem;
  border-right:0.03rem solid #eee; 
  text-align: center;
}
.btnsArr a{
  width: 100%;
  height: 100%;
  color: #333;
  display: block;
}
/*悬浮框*/
.checkfu{
  position: fixed;
  top: 0;
  left: 0;
  margin-top: 0;
  background: #fff;
  z-index: 500;
}
/*占位框*/
.zhanwei{
  display: block;
  height: 0.01rem;
  width: 100%;
  transition:all 0.2s;
}
.zhanweis{
  display:block;
  visibility:hidden;
  height: 7rem;
}
/*暂无评论*/
.zanwu{
  padding: 0.32rem;
  line-height: 2rem;
  color: #999999;
  font-size: 0.64rem;
}
/*店铺活动*/
.discount{
  padding: 0.32rem;
  padding-left: 1rem;
  position: relative;
  background-image: url(../../assets/store/shop_round_jian.png); 
  background-repeat: no-repeat;
  background-position:left 0.32rem;
  background-size: 0.85rem;
}
.discount .discount_title{
  font-size: 0.64rem;
  color: #333;
}
.discount p{
  font-size: 0.55rem;

}
</style>
<style>
  .swipers .swiper-pagination-bullet{
    width: 0.32rem;
    height:0.32rem;
    background: #999;
    opacity: 1;
    transition:all 0.2s;
  }
    .swipers span.swiper-pagination-bullet.swiper-pagination-bullet-active{
    width: 0.64rem;
    height: 0.32rem;
    background-color: #50e3c2!important;
    border-radius: 0.15rem;
  }
</style>
<template>
  <div id="storeInt">
  <div v-title data-title="店铺详情">
  </div>
<!-- 轮播图 -->
    <div class="swiperbox swipers">
      <swiper class="storeints" :options="swiperOption"  ref="mySwiper">
            <swiper-slide v-for="item in items">
              <img :src="item" alt="">
            </swiper-slide> 
<!-- 这是轮播的小圆点 -->  
      <div class="swiper-pagination" slot="pagination"></div>       
      </swiper>
      <!-- 轮播右下角  -->
      <div class="picLogo" @click="gophoto">
        <div class="imgPic"></div>
        <span>{{photoNum}}</span>
      </div>
    </div>
    <!-- 占位框 -->
<!-- 店铺买单     -->
    <div class="zhanwei"></div>
    <div class="check" :class="checkfu ? 'checkfu' : 'check'">
<!-- 标题 -->
      <div class="checkTitle">{{storeData.name}}</div>
<!-- 小星星  -->
      <div class="storeStart">
        <div class="start" :class="storeData.score>=1 ? 'start1' : 'start' "></div>
        <div class="start" :class="storeData.score>=2 ? 'start1' : 'start' "></div>
        <div class="start" :class="storeData.score>=3 ? 'start1' : 'start' "></div>
        <div class="start" :class="storeData.score>=4 ? 'start1' : 'start' "></div>
        <div class="start" :class="storeData.score>=5 ? 'start1' : 'start' "></div>
        <span>{{storeData.score}}分</span>
      </div>
 <!-- 消费水平      -->
      <div class="storedata">
        <span class="renjun">人均: ¥<span>{{storeData.equally_price}}</span></span>
        <span>月消费人次: <span>{{storeData.pay_times}}</span></span>
      </div> 
 <!-- 营业时间      -->
      <div class="storeTime">
        <span>营业时间：<span>{{storeData.optime}}</span></span>
      </div>
<!-- 买单       -->
    <div class="buyBtn" v-on:click="gobuy">买单</div>
    </div>
<!-- 横线 -->
      <div class="storebr dizhi"></div>
<!-- 店铺地址以及电话       -->
      <div class="introduce">
        <div class="address" @click="goMap">
          <p>{{storeData.address}}</p>
          <p>距离您：<span>{{storeData.distance}}</span></p>
        </div>
        <div class="phone" @click="call()"></div>
      </div>    
<!-- 店铺活动 -->
      <div class="characteristic" v-if="huodong.length != 0">
        <div class="characteristicTxt">店铺活动</div>
        <div class="heng"></div>
        <div class="discount">
          <p><span>消费满<span style="color:#ff372c">{{huodong[0].money}}</span>元</span>&nbsp;&nbsp;&nbsp;<span>可抵扣<span style="color:#53c7ca">{{huodong[0].quan}}</span>个券</span></p>
        </div>
      </div>
<!-- 店铺特色     -->
      <div class="characteristic">
        <div class="characteristicTxt">店铺特色</div>
        <div class="heng"></div>
        <div class="characteristicCon" v-if="storeData.is_wifi == 1">有免费Wi-Fi</div>
        <div class="characteristicCon" v-if="storeData.is_park == 1">有停车位</div>
        <div class="characteristicCon">{{storeData.feature}}</div>
      </div>
<!-- 评论       -->
      <div class="comment">
        <div class="commentZong">
          <div class="storeStart">
            <div class="start" :class="storeData.score>=1 ? 'start1' : 'start' "></div>
            <div class="start" :class="storeData.score>=2 ? 'start1' : 'start' "></div>
            <div class="start" :class="storeData.score>=3 ? 'start1' : 'start' "></div>
            <div class="start" :class="storeData.score>=4 ? 'start1' : 'start' "></div>
            <div class="start" :class="storeData.score>=5 ? 'start1' : 'start' "></div>
            <span>{{storeData.score}}分</span>
            <span class="commentNum"><span>{{storeData.comments}}</span>条 评价</span>
          </div>          
        </div>
        <div class="storebr"></div>
        <!-- 评论详情 -->
        <section class="aui-content">
          <div v-if="oneNum==0" class="zanwu">暂无评论~~~~~~</div>
          <div class="aui-card-list" v-if="oneNum!=0">
            <div class="aui-card-list-header aui-card-list-user">
                <div class="aui-card-list-user-avatar">
                    <img :src="oneCom.userHead" class="aui-img-round">
                </div>
                <div class="aui-card-list-user-name">
                    <div class="aui-text-info">{{oneCom.userName}}</div>
                </div>
                <div class="aui-card-list-user-info text-light">
                    <div class="storeStart">
                      <div class="start" :class="oneCom.level>=1 ? 'start1' : 'start' "></div>
                      <div class="start" :class="oneCom.level>=2 ? 'start1' : 'start' "></div>
                      <div class="start" :class="oneCom.level>=3 ? 'start1' : 'start' "></div>
                      <div class="start" :class="oneCom.level>=4 ? 'start1' : 'start' "></div>
                      <div class="start" :class="oneCom.level>=4 ? 'start1' : 'start' "></div>
                      <span style="color:#9d9d9d">{{oneCom.createTime}}</span>
                </div>        
                </div>
            </div>
            <div class="aui-card-list-content-padded aui-padded-t-5 aui-padded-b-5">{{oneCom.content}}</div>
            <div class="aui-card-list-content">
                <div class="aui-row aui-row-padded">
                    <div class="aui-col-xs-4" v-for="item in oneCom.picture">
                      <img :src="item" alt="" @click="goImg(item)">
                    </div>
                </div>
            </div>
          </div>
        </section>        
      </div>
<!-- 查看更多评论       -->
      <div class="seebtn" @click="lookP"><div class="storebr"></div><p>查看全部评价</p></div>
      <!-- 弹框 -->
    <div class="rodiasex" :style="{display: displays}">
      <div class="sexs">
        <div class="sexTitle">呼叫电话</div>
         <div class="aui-list-item-inner" style="margin:0 auto;display:block;text-align:center;font-size:0.64rem;line-height:1.2rem;">
                {{storeData.telephone}}
          </div>
          <!-- 确定按钮框 -->
          <div class="btnsArr">
          <div v-on:click="tijiao()">取消</div>
          <div v-on:click="tijiao()"><a href="tel:storeData.telephone">确定</a></div>
          </div>
      </div>
    </div>
  </div>
</template>
<script>
import '../../../static/css/aui.css'
import { swiper, swiperSlide } from 'vue-awesome-swiper'
import wx from 'weixin-js-sdk'
export default {
  name: 'storeInt',
  components: {
    swiper,
    swiperSlide
  },
  data () {
    return {
      // 轮播插件
      swiperOption: {
        notNextTick: true,
        pagination: '.swiper-pagination',
        slidesPerView: 'auto',
        centeredSlides: true,
        paginationClickable: true,
        loop: true,
        spaceBetween: 30,
        autoplayDisableOnInteraction: false,
        autoplay: 2000,
        onSlideChangeEnd: swiper => {
          this.page = swiper.realIndex + 1
          this.index = swiper.realIndex
        }
      },
      items: [{}], // 轮播图
      storeData: '', // 店铺数据
      start: 4, // 店铺评分
      displays: 'none',
      checkfu: false, // 浮动
      jingweidu: this.$store.state.jingweidu, // 经纬度
      oneCom: [], // 一条店铺评论
      oneNum: 0,
      huodong: [], // 店铺活动
      picNum1: 0, // 店铺数量
      photoNum: 0 // 相册数量
    }
  },
  computed: {
    // 轮播调用
    swiper () {
      return this.$refs.mySwiper.swiper
    }
  },
  mounted () {
    this.swiper.slideTo(0, 0, false)
    window.addEventListener('scroll', this.menu)
    // 获取店铺详情
    this.$http.post(this.$store.state.postUrl + '/Api/Store/getStoreDetail', {'storeId': this.$route.query.storeId, 'longitude': this.jingweidu.longitude, 'latitude': this.jingweidu.latitude}, {emulateJSON: true})
    .then(function (res) {
      if (res.body.code === 10000) {
        this.items = res.body.data.banner
        if (res.body.data.distance >= 1000) {
          var kms = res.body.data.distance / 1000
          res.body.data.distance = kms.toFixed(2) + 'km'
        } else {
          res.body.data.distance = res.body.data.distance + 'm'
        }
        this.storeData = res.body.data
        this.photoNum = res.body.data.picNum1 + res.body.data.picNum2
      }
    })
    // 获取店铺活动
    this.$http.post(this.$store.state.postUrl + '/Api/Store/getStoreActivity', {'storeId': this.$route.query.storeId}, {emulateJSON: true})
    .then(function (res) {
      this.huodong = res.body.data
    })
  },
  methods: {
    // 查看评论
    lookP: function () {
      this.$router.push({ path: '/comment/index?storeId=' + this.$route.query.storeId })
    },
    // 电话弹框
    tijiao: function () {
      this.displays = 'none'
    },
    call: function () {
      this.displays = 'block'
    },
    // 判断滚动
    menu: function () {
      let sco = document.getElementsByClassName('zhanwei')[0].offsetTop
      this.scroll = document.body.scrollTop
      if (this.scroll >= sco) {
        this.checkfu = true
      } else {
        this.checkfu = false
      }
    },
    // 买单
    gobuy: function () {
      this.$router.push({ path: '/checkout?storeId=' + this.$route.query.storeId })
    },
    // 查看地图
    goMap: function () {
      wx.ready(function () {
        wx.openLocation({
          latitude: this.storeData.latitude, // 纬度，浮点数，范围为90 ~ -90
          longitude: this.storeData.longitude, // 经度，浮点数，范围为180 ~ -180。
          name: '乐聪测试', // 位置名
          address: '', // 地址详情说明
          scale: 1, // 地图缩放级别,整形值,范围从1~28。默认为最大
          infoUrl: '' // 在查看位置界面底部显示的超链接,可点击跳转
        })
      })
    },
    // 查看图片
    goImg: function (url) {
      this.$router.push({ path: '/imgcon/views?url=' + url })
    },
    // 跳转相册
    gophoto: function () {
      this.$router.push({ path: '/store/storephoto?storeId=' + this.$route.query.storeId + '&img1=' + this.storeData.picNum1 + '&img2=' + this.storeData.picNum2 })
    }
  },
  // 移除监听事件
  beforeRouteLeave (to, from, next) {
    window.removeEventListener('scroll', this.menu)
    next()
  }
}
</script>
