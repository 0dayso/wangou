<style scoped>
  .swiper-container{
    height: 7.68rem;
  }
  .swiper-slide {
    background-repeat: no-repeat;
    background-size: 100% 7.68rem;
  }
  .gamebg{
    width: 2.56rem !important;
    height: 2.56rem !important;
    background-size: 100%!important;
  }
  .aui-col-xs-4 .aui-4img{
    width: 100%;
    height: 3.2rem;
    background-repeat: no-repeat;
    background-size: 100%  3.2rem;
  }
    .aui-list .aui-list-item-inner{
    padding-right: 0;
    border:0;
  }
  /*商品名称*/
    .aui-list .aui-list-item-title{
    font-size: 0.64rem;
    margin-top: 0.32rem;
    font-weight: 700;
  }
   .aui-list .food_dizhi{
    font-size: 0.533rem;
    color: #999;
    font-weight: 400;
    width: 73%;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 0.746rem;
    height: 0.746rem;
    display: inline-block;
  } 
  /*家乡游戏间距*/
  .aui-card-list-user-info{
    font-size: 0.533rem;
    color: #999;
    margin-top: 0.32rem;
  }
  /*星星*/
   .start,.start0{
    width: 0.64rem;
    height: 0.64rem;
    margin-right: 0.106rem;
    float: left;
    background-size: cover;
    background-image: url(../assets/store/start.png);
    background-repeat: no-repeat;
  }
  .start0{
      background-image: url(../assets/store/start0.png);
  } 
  .start2{
    background-image: url(../assets/store/start0.png);
  }
    .tuijianbg{
    background:none !important;
    border-radius:0!important;
    padding:0!important;
    height:auto!important;
  }
  .aui-col-xs-4{
    height: 4.906rem;
    text-align: center;
  }
  .aui-row-padded .aui-4a{
    font-size: 0.64rem;
    color: #333333;
    display: block;
    margin:0.426rem auto;
  }
  .aui-row-padded{
    padding: 0 0.853rem;
  }
  .aui-tui{
    width: 4.266rem;
    line-height: 2.133rem;
    position: relative;
    font-size: 0.64rem;
    color: #666666;
    text-align: center;
    margin:0 auto;
  }
  .delauipadding{
    padding: 0!important;
  }
  .aui-card-list{
    margin-bottom: 0;
    background: transparent;
  }
  .aui-heng{
    width: 1.173rem;
    height: 0.05rem;
    background: #cccccc;
    position: absolute;
    left: -1.493rem;
    top: 50%;
    margin-top: -0.0107rem;
  }
  .heng2 {
    width: 1.173rem;
    height: 0.05rem;
    background: #cccccc;
    position: absolute;
    right: -1.493rem;
    top: 50%;
    margin-top: -0.0107rem;
  }
  .tuijianbg{
    background: #fff;
  }
  .aui-timeline-item{
    margin-top: 0.64rem;
  }
  .aui-list .aui-list-item{
    padding:0 0.426rem;
  }
  .hometowngame .aui-list .aui-list-item{
    padding:0 0.64rem;
    border-bottom: 0;
  }
  .aui-shops-header{
    width: 3.2rem;
  }
  .aui-list .aui-list-item-media{
    width: auto;
  }
  .aui-list .aui-list-item-media{
    padding: 0.64rem 0;
    padding-right: 0.533rem;
  }
  /*清除默认底部背景*/
  .aui-content .aui-media-list, .clearbg{
    background-image: none!important;
  }
  .aui-content{
    position: relative;
  }
  /*清除默认border*/
  .clearbor{
    border:0!important;
  }
  .aui-list .aui-list-item{
    background-size: 0;
  }
  .aui-list-item .aui-media-list-item-inner{
    border-bottom: 0.05rem solid #eeeeee;
  }
  .aui-list .aui-list-item-text{
    font-size: 0.746rem;
  }
    /*广告位招商*/
  .advertisement{
    width: 100%;
    height: 6.826rem;
    margin-top: 0.64rem;
    background-repeat: no-repeat;
    background-size: cover;
    position: relative;
  }
  .advertisement_border{
    width: 13.866rem;
    height: 4.809rem;
    border:0.05rem solid #fff;
    position: absolute;
    left: 50%;
    margin-left: -6.933rem;
    top: 50%;
    margin-top: -2.4045rem;
    padding: 0.384rem;
  }
  .advertisement_border .txt{
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.8);
    overflow: hidden;
    text-align: center;
  }
  /*广告位字间距*/
  .txt .txt1{
    margin-top: 1.066rem;
    color: #333333;
    letter-spacing:0.32rem;
    font-weight: 600;
  }
  .txt .txt2{
    margin:0.226rem auto 0;
    width: 4.266rem;
    color: #333333;
    font-size: 0.64rem;
    text-align: center;
    letter-spacing:0.106rem;
    position: relative;
  }
  .advertisement_heng,.advertisement_heng1{
    width: 0.64rem;
    height: 0.05rem;
    background: #333;
    position: absolute;
    top: 50%;
    margin-top:-0.025rem;
  }
  .advertisement_heng{
    left: -0.64rem;
  }
  .advertisement_heng1{
    right: -0.64rem;
  }
   /*广告位招商end*/
  /*推荐商铺左侧*/
  .shopsback{
    padding: 0;
    width: 3.413rem;
    position: relative;
    height: 3.413rem;
    background-repeat: no-repeat;
    background-size: cover;
  }
  /*推荐商铺*/
  .storetit{
    margin-top: 0.32rem !important;
  }
  .goods .storetit{
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    display: inline-block;
    width: 80%;
  }
  /*人均消费*/
  .storexf{
    width: 100%;
    margin-top: 0.213rem !important;
    font-size: 0.533rem;
    color: #999999;
    overflow: hidden;
  }
  /*评分*/
  .starttxt{
    color: #f5a623;
  }
  .tuijian2 .starttxt span{
    float: left;
    margin-left: 0.213rem;
  }
  /*推荐2个*/
  .tuijian2 .aui-col-xs-6{
    width: 44%;
    padding: 0.96rem 0;
    margin-left: 4%;
    background-image: none;
  }
  /*推荐2个（商品）*/
  .goods .tuijian2 .aui-col-xs-6{
    width: 37.33%;
    margin-left: 8%;
  }
  .tuijian2 .pictwo{
    position: relative;
    width: 7.04rem;
    height: 4.693rem;
    background-repeat: no-repeat;;
    background-position: center;
    margin: 0 auto;
    background-size: 7.04rem 4.693rem;
  }
  /*商品标题*/
  .tuijian2 .foodtit{
    padding-left: 0.213rem;
    margin: 0 auto;
    margin-top: 0.426rem;
    font-size: 0.64rem!important;
    font-weight: 700;
    text-align: left;
    width: 7.04rem;
    color: #333;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }
  .tuijian2  .starttxt{
    padding-left: 0.213rem;
    width: 7.04rem;
    margin: 0 auto;
    margin-top: 0.213rem;
    overflow: hidden;
  }
  .tuijian2 .storexf{
    padding-left: 0.213rem;
    width: 7.04rem;
    text-align: left;
    margin: 0 auto;
    margin-top: 0.32rem!important;
  }
  .xfsss{
    padding-left: 1.066rem!important;
    background-image: url(../assets/prices0.png);
    background-size: 0.746rem 0.426rem;
    background-repeat: no-repeat;
    background-position: center left;
  }
  /*店铺推荐3个*/
  .tuijian3 .clearbg{
    padding: 0 0.64rem;
  }
  /*查看更多*/
  .up_more{
    width: 100%;
    height: 1.92rem;
    color: #ccc;
    line-height: 1.92rem;
    text-align: center;
    background: #fff;
    font-size: .534rem;
  }
  /*推荐商品 原价*/
  .goods  .originalprice{
    font-size: 0.469rem;
    margin-top: 0.213rem;
    color: #999;
    text-align: left;
  }
  .goods  .originalprice2{
    padding-left: 0.213rem;
  }
  .goods  .picori{
    position: relative;
    width: 5.973rem;
    height: 5.973rem;
    background-size:5.973rem 5.973rem;
  }
  .goods .foodtit,.goods .storexf2,.goods .originalprice2{
    width: 100%;
    margin: 0.213rem auto 0;
  }
  .goods .storexf2{
    margin-left: 0.213rem;
  }
  /*推荐*/
  .tuijian{
    position: absolute;
    width: 1.813rem;
    height: 1.813rem;
    top: 0;
    left: 0;
    background-image: url(../assets/tuijian.png);
    background-size: 100%;
  }
    /*单个物品*/
  .goodsa{
    padding:0.64rem 4%;
    background-color: #fff;
    margin-bottom: 0.64rem;
  }
  .goodsge{
    width: 14.72rem;
    height: 6.4rem;
    background-size: 100%;
    background-position: center;
    background-repeat: no-repeat;
  }
  .goodsa .goods_price span{
    float: left;
  }
  .goodsa .goodstit{
    margin-top: 0.64rem;
    padding-left: 0.213rem;
    font-size: 0.746rem;
    color: #333333;
  }
  .goodsa .aui-exchange-img{
    float: left;
    font-size: 0.512rem;
    color: #999;
    display: inline-block;
    padding-left: 0.96rem;
    background-size: 0.746rem 0.469rem;
    background-repeat: no-repeat;
    background-position: center left;
    background-image: url(../assets/prices0.png);
    margin-left: 0.64rem;
  }
  .goodsa .goods_price{
    overflow: hidden;
    margin-top: 0.64rem;
    padding-left: 0.213rem;
    line-height: 0.746rem
  }
  .goodsa .goods_price .price{
    font-size: 0.64rem;
    color: #ff405d;
    font-weight: 700;
  }
  .newst{
    color: #53c7c4;
  }
  .goodsbg{
    width: 100%;
    height: 5.973rem;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  /* 家乡游戏 start */
  .hometowngame .aui-list .aui-list-item-title{
    margin-top: 0rem;
  }
  .hometowngame .aui-list-item-inner{
    border-bottom: 0;
  }
  .aui-list-item-right{
    font-size: 0.533rem;
    color: #999;
    margin-top: 0.32rem;
  }
  .location_img{
    display: inline-block;
    width: 0.5333rem;
    height: 0.64rem;
    background: url(../assets/index/dizhi.png);
    background-size: contain;
    background-repeat: no-repeat;
    margin-right: 0.213rem;
  }
  .up_more{
    width: 100%;
    height: 1.92rem;
    color: #cccccc;
    line-height: 1.92rem;
    text-align: center;
    font-size: 0.534rem;
  }
  .stargame{
    position: absolute;
    width: 2.986rem;
    height: 1.28rem;
    right: 0;
    top: 50%;
    margin-top: -0.64rem;
    background-size: 2.986rem 1.2rem;
    background-image: url(../assets/index/stargame.png);
    background-repeat: no-repeat;
  }
  .game_titie{
    margin-top: 0.213rem;
  }
  .stargame{
    position: absolute;
    width: 2.986rem;
    height: 1.28rem;
    right: 0;
    top: 50%;
    margin-top: -0.64rem;
    background-size: 2.986rem 1.28rem;
    background-image: url(../assets/index/stargame.png);
    background-repeat: no-repeat;
  }
  .game_titie{
    margin-top: 0.213rem;
    font-weight: 100;
  }
  .aui-list .game_titie .aui-list-item-title{
    font-weight: 400;
  }
   /* 家乡游戏 end */  
   .hometowngame .aui-card-list-user-info{
    margin-top: 0.1065rem;
   }
.pri2c{
  color: #ff405d!important;
  font-size: 0.469rem;
}
.dange{
  height: 6.4rem;
  background-size: 100%;
  background-position: center;
  background-repeat: no-repeat;
}
.sahng{
  padding:0.64rem!important;
}
.sopb{
  width: 100%;
  height: 4.693rem;
  margin:0 auto;
  background-size: 100%;
  background-position: center;
  background-repeat: no-repeat;
}
/*评分*/
.score{
  color: #f5a623;
  margin-left: 0.32rem;
}
/*  未注册游戏弹窗 */
.join{
  display: none;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.6);
  position: fixed;
  top: 0;
  left:0;
  z-index: 500;
  overflow: scroll;
}
.join .entrance{
  width: 12.16rem;
  height: 19.413rem;
  margin: 2.346rem auto 0;
  position: relative;
}
.join .entrance img{
  width: 100%;
}
.join .close_join{
  width: 1.6rem;
  height: 1.6rem;
  background-image: url(../assets/close.png);
  background-repeat: no-repeat;
  background-position: top center;
  background-size: 100%;
  position: absolute;
  bottom: 0;
  left: 50%;
  margin-left: -0.8rem;
}
h5{
  display: block!important;
  text-align: center;
  width: 100%;
  line-height: 5rem;
}
    /*加载*/
.loading{
  width: 1.2rem;
  height: 2rem;
  margin: 0.64rem auto 0.64rem;
  overflow: hidden;
  text-align: center;
}
  /*没有更多*/
#app .noMore{
  width: 100%;
  height: 1.92rem;
  color: #cccccc;
  line-height: 1.92rem;
  text-align: center;
  font-size: 0.534rem;
} 
  /*提示框*/
.mint-popup{
  background-color: transparent;
  color: #fff;
  width: 100%;
  font-size: 0.64rem;
  text-align: center;
  line-height: 30px;
}
.mint-popup img{
  position: absolute;
  top: 0.5rem;
  right: 1.5rem;
  width: 1.5rem;
}
  /*微信提示框*/
.wxTi{
  width: 100%;
  height: 3.84rem;
  background-color: #505556;
  box-shadow: 0 -9px 29px -7px rgba(0,0,0,.1) inset;
}
</style>
<style>
  .swipers .swiper-pagination-bullet{
    width: 0.32rem;
    height:0.32rem;
    background: #999;
    opacity: 1;
    transition:all 0.2s;
  }
    .swipers span.swiper-pagination-bullet.swiper-pagination-bullet-active{
    width: 0.64rem;
    height: 0.32rem;
    background-color: #50e3c2!important;
    border-radius: 0.15rem;
  }
  .aui-margin-b-15{
    margin-bottom: 0 !important;
  }
  .aui-timeline-item{
    margin-top: 0!important;
  }
</style>
<template>
  <div id="index">
  <div v-title data-title="首页">
  </div>
  <!-- 底部 -->
  <componentName></componentName>
      <!-- 轮播图 -->
      <div class="swipers">
      <swiper :options="swiperOption"  ref="mySwiper">
            <swiper-slide v-for="item in items">
              <img :src="item.imgUrl"  @click="goBanner(item.type, item.returnId, item.webUrl)">
            </swiper-slide>
<!-- 这是轮播的小圆点 -->
            <div class="swiper-pagination" slot="pagination"></div>  
      </swiper>
        <!-- 推荐商品   -->
        <div class="aui-timeline-item hometowngame goods">
          <div class="aui-timeline-item-inner">
            <div class="aui-card-list tui-v">
              <div class="aui-tui aui-shops-header"><div class="aui-heng"></div>推荐商品<div class="heng2"></div></div>
            </div>
          </div>
         <!-- 单个推荐        -->
      <div v-if="shangNum == 1" class="aui-card-list-content goodsa" v-for="item in goods" v-on:click="goprizeInt(item.goodsId)" >
        <div class="goodsge" v-bind:style="{'background-image':'url('+item.goodsImage+')'}"></div>
        <div class="goodstit">
          {{item.goodsName}}
        </div>
        <div class="goods_price"><span class="price">¥{{item.amount}}</span><div class="aui-exchange-img"><span>可用抵扣价格</span><span class="newst">&nbsp;¥{{item.discount}}</span></div></div>
      </div>
          <!-- 推荐商品————两个        -->
          <section class="aui-content aui-grid aui-margin-b-15 tuijian2">
            <div class="aui-row">
            <div class="aui-col-xs-6 aui-border-r" v-if="shangNum == 2"  v-for='item in goods' v-on:click="goprizeInt(item.goodsId)">
                <div class="aui-card-list-content tuijian2 goodsbg" v-bind:style="{'background-image':'url('+item.goodsImage+')'}">
                  <div class="tuijian" v-if="item.is_recommend==1"></div>
                </div>
                <div class="aui-gird-lable aui-font-size-12 foodtit">{{item.goodsName}}</div>
                <div class="originalprice  originalprice2 pri2c">¥<span>{{item.amount}}</span></div>
                <div class="storexf storexf2 xfsss">抵扣劵支持： <span class="newst">¥{{item.discount}}</span></div>
            </div>
            </div>
          </section>
        <!-- 推荐商品3个 -->
        <div class="aui-content aui-margin-b-15">
            <ul class="aui-list aui-media-list">
              <li class="aui-list-item clearbg" v-if="shangNum >= 3" v-for='item in goods' v-on:click="goprizeInt(item.goodsId)">
                <div class="aui-media-list-item-inner">
                  <div class="aui-list-item-media">
                    <div class="aui-4img shopsback"   v-bind:style="{'background-image':'url('+item.goodsImage+')'}">
                      <div class="tuijian" v-if="item.is_recommend==1"></div>
                    </div>
                  </div>
                  <div class="aui-list-item-inner">
                    <div class="aui-list-item-text">
                      <div class="aui-list-item-title storetit"><span>{{item.goodsName}}</span></div>
                    </div>
                    <div class="originalprice pri2c">¥<span>{{item.amount}}</span></div>
                    <!-- 抵扣劵 -->
                    <div class="storexf xfsss">抵扣劵支持： <span class="newst">¥{{item.discount}}</span></div>
                  </div>
                </div>
              </li>
            </ul>
            <div  class="up_more" v-if="shangNum >= 3">查看更多</div>
        </div>
        </div>      
      </div>
        <!-- 广告位    -->
        <div class="advertisement" v-bind:style="{'background-image':'url('+indexGao.imgUrl+')'}" @click="goBanner(indexGao.type, indexGao.returnId, indexGao.webUrl)">

        </div>
        <!-- 推荐商铺 -->
        <div class="aui-timeline-item hometowngame">
          <div class="aui-timeline-item-inner">
            <div class="aui-card-list tui-v">
              <div class="aui-tui aui-shops-header"><div class="aui-heng"></div>推荐商铺<div class="heng2"></div></div>
            </div>
          </div>
         <!-- 单个推荐        -->
          <div class="aui-content aui-margin-b-15" v-if="dianNum == 1">
              <ul class="aui-list aui-media-list">
                  <li class="aui-list-item sahng" v-for='item in shoparrs' v-on:click="goInt(item.store_id)">
                    <div class="aui-card-list-content dange" v-bind:style="{'background-image':'url('+item.logo+')'}">
                        <div class="tuijian" v-if="item.top==1"></div>
                        </div>
                    <div class="aui-list-item-inner">
                      <div class="aui-list-item-text">
                          <div class="aui-list-item-title"><span>{{item.name}}</span></div>
                      </div>
                      <div class="aui-card-list-user-info"><div class="start" :class="item.score < 1 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 2 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 3 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 4 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 5 ? 'start' : 'start2'"></div><span class="score">{{item.score}}分</span><span> &nbsp;&nbsp;¥{{item.equally_price}} / 人</span></div>
                      <div class="aui-list-item-text">
                        <div class="aui-list-item-title food_dizhi"><i class='location_img'></i>{{item.address}}</div>
                          <div class="aui-list-item-right">{{item.distance}}</div>
                        </div>
                    </div>
                  </li>
              </ul>
          </div> 
          <!-- 推荐商铺————两个        -->
          <section class="aui-content aui-grid aui-margin-b-15 tuijian2" v-if="dianNum == 2">
            <div class="aui-row">
            <div class="aui-col-xs-6 aui-border-r"  v-for='item in shoparrs' v-on:click="goInt(item.store_id)">
                <div class="aui-card-list-content sopb" v-bind:style="{'background-image':'url('+item.logo+')'}">
                  <div class="tuijian" v-if="item.top==1"></div>
                </div>
                <div class="aui-gird-lable aui-font-size-12 foodtit">{{item.name}}</div>
                <div class="aui-card-list-user-info starttxt"><<div class="start" :class="item.score < 1 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 2 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 3 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 4 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 5 ? 'start' : 'start2'"></div><span>{{item.score}}分</span></div>
                <div class="storexf">人均消费： ¥<span>{{item.equally_price}}</span></div>
            </div>
            </div>
          </section>
        </div>
         <mt-popup v-model="popupVisible" popup-transition="popup-fade" position="top">
          <div class="wxTi">
            <span>点击右上角菜单</span><br>
            <span>在默认浏览器中打开游戏</span>
            <img src="../assets/arrow.png" alt="">
          </div>
         </mt-popup>
        <!-- 推荐商铺3个 -->
        <div class="aui-content aui-margin-b-15 tuijian3" v-if="dianNum == 3">
            <ul class="aui-list aui-media-list">
              <li class="aui-list-item clearbg" v-for='item in shoparrs' v-on:click="goInt(item.store_id)">
                <div class="aui-media-list-item-inner cleardiv">
                  <div class="aui-list-item-media">
                    <div class="aui-4img shopsback"   v-bind:style="{'background-image':'url('+item.logo+')'}">
                      <div class="tuijian" v-if="item.top==1"></div>
                    </div>
                  </div>
                  <div class="aui-list-item-inner">
                    <div class="aui-list-item-text">
                      <div class="aui-list-item-title storetit"><span>{{item.name}}</span></div>
                    </div>
                    <div class="aui-card-list-user-info starttxt"><div class="start" :class="item.score < 1 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 2 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 3 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 4 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 5 ? 'start' : 'start2'"></div><span class="score">{{item.score}}分</span><span style="color:#999;"> &nbsp;&nbsp;¥{{item.equally_price}}/人</span></div>
                    <div class="aui-list-item-text">
                        <div class="aui-list-item-title food_dizhi"><i class='location_img'></i>{{item.address}}</div>
                          <div class="aui-list-item-right">{{item.distance}}</div>
                    </div>
                  </div>
                </div>
              </li>
            </ul>
            <div  class="up_more">查看更多</div>
        </div>
        <!-- 游戏推荐 -->
        <div class="aui-timeline-item hometowngame">
                <div class="aui-timeline-item-inner">
                    <div class="aui-card-list tui-v">
                        <div class="aui-tui aui-shops-header"><div class="aui-heng"></div>家乡游戏<div class="heng2"></div></div>
                        </div>
                      <div class="aui-content aui-margin-b-15">
                      <ul class="aui-list aui-media-list"  v-infinite-scroll="loadMore" infinite-scroll-disabled="loading" infinite-scroll-distance="10">
                        <li class="aui-list-item" v-for='item in gameArr'>
                          <div class="aui-media-list-item-inner">
                            <div class="aui-list-item-media">
                              <div class="aui-4img gamebg" v-bind:style="{'background-image':'url('+item.img+')'}"></div>
                            </div>
                        <div class="aui-list-item-inner">
                            <div class="aui-list-item-text game_titie">
                               <div class="aui-list-item-title">{{item.title}}</div>
                            </div>
                                <div class="aui-card-list-user-info">{{item.pers}}人在玩</div>
                            <div class="aui-list-item-text">
                            <div class="aui-list-item-title food_dizhi">{{item.intr}}</div>
                                </div>
                         <!-- 开启游戏        -->
                         <div class="stargame" @click="goGame(item.scheme)">
                         </div>
                        </div>
                        </div>
                      </li>
                    </ul>
                    <div v-if="nomore" class="noMore">没有更多</div>
                    <div class="loading" v-if="loadings"><mt-spinner  type="fading-circle"></mt-spinner></div>
                    <h5 v-if="dataLength">暂无相关商品</h5> 
                </div>
                </div>
        </div>  
        <!-- 未注册弹框       -->
        <div class="join" v-if="close">
          <!-- 广告图 -->
          <div class="entrance">
            <img src="../assets/index/joingame.png" alt="未成为尚尚用户">
          <!-- 关闭弹窗 -->
              <div class="close_join" @click="colseJoin"></div>
          </div>
        </div>
  </div>
</template>
<script>
let guanggao = require('../assets/guanggao.png')
import '../../static/css/aui.css'
import { swiper, swiperSlide } from 'vue-awesome-swiper'
import { InfiniteScroll, Popup } from 'mint-ui'
import wx from 'weixin-js-sdk'
import 'mint-ui/lib/style.css'
export default {
  components: {
    swiper,
    swiperSlide,
    InfiniteScroll,
    Popup
  },
  data () {
    return {
      popupVisible: false,
      swiperOption: { // 轮播图
        notNextTick: true,
        pagination: '.swiper-pagination',
        slidesPerView: 'auto',
        centeredSlides: true,
        paginationClickable: true,
        autoplayDisableOnInteraction: false,
        autoplay: 2000,
        spaceBetween: 30,
        onSlideChangeEnd: swiper => {
          this.page = swiper.realIndex + 1
          this.index = swiper.realIndex
        }
      },
      indexGao: '',
      items: [{'imgUrl': ''}],
      goods: [{}],
      guanggao: guanggao,
      shoparrs: [], // 商品列表
      gameArr: [], // 游戏列表
      shangNum: 0, // 判断商品数量
      dianNum: 0, // 判断店铺数量
      falses: false,
      // 弹窗
      close: true,
      // 令牌
      ssAuth: this.$store.state.ssAuth,
      // 公众号编码
      gzhCode: this.$store.state.gzhCode,
      // 对应的用户所剩券 （根据商品的来源平台、省、公众 ）
      page: 1,
      dataLength: false,
      loadings: true,
      nomore: false,
      loading: true,
      wxconfig: '',
      jingweidu: this.$store.state.jingweidu // 经纬度
    }
  },
  computed: {
    swiper () {
      return this.$refs.mySwiper.swiper // 轮播
    }
  },
  mounted () {
    sessionStorage.wgUserid = this.GetQueryString('user_id') // 存储id
    this.$store.state.ssAuth = this.GetQueryString('ssauth') // 存储令牌
    this.$store.state.gzhCode = this.GetQueryString('gzh_code') // 公众号
    this.$store.state.shijianc = this.GetQueryString('create_time') // 时间戳
    this.$store.state.openid = this.GetQueryString('openid') // openId
    this.ssAuth = this.GetQueryString('ssauth')
    this.gzhCode = this.GetQueryString('gzh_code')
    this.$store.state.ticket = this.GetQueryString('ticket')
    // this.$store.state.ssAuth = '59129b68d1ddd8a05cdc1c8bdf2a09d3'
    // this.$store.state.gzhCode = '63B0670AF815D506' // 公众号
    this.getUserdata()
    this.swiper.slideTo(3, 1000, false)
    var u = navigator.userAgent
    var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1 // android终端
    var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)
    if (isAndroid) {
      this.device = 0
    } else if (isiOS) {
      this.device = 1
    }
    // 验证时间戳
    this.shijianchuo()
    // 获取微信配置
    this.$http.post(this.$store.state.postUrl + '/Api/App/getWechatSign', {'ticket': this.$store.state.ticket, 'url': window.location.href.split('#')[0]}, {emulateJSON: true})
    .then(function (res) {
      if (res.body.code === 10000) {
        this.$store.state.wxConfig = res.body.data
        this.wxconfig = res.body.data
        // 配置微信信息
        wx.config({
          debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
          appId: this.$store.state.wxConfig.appId, // 必填，公众号的唯一标识
          timestamp: this.$store.state.wxConfig.timestamp, // 必填，生成签名的时间戳
          nonceStr: this.$store.state.wxConfig.nonceStr, // 必填，生成签名的随机串
          signature: this.$store.state.wxConfig.signature, // 必填，签名，见附录1
          jsApiList: ['getLocation'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
        })
        var th = this
        wx.ready(function () {
// 获取经纬度
          wx.getLocation({
            type: 'wgs84',
            success: function (res) {
              // 纬度
              th.jingweidu = res
              th.$store.state.jingweidu = res
              // 获取推荐商城
              th.getDian()
            },
            cancel: function (res) {
              th.getDian()
            }
          })
        })
      }
    })
    // 获取配置结束
    this.getBanner()
    this.getData()
    // 获取推荐商品
    this.getShang()
    this.getDian()
    // 获取广告
    this.getGao()
  },
  methods: {
    // 查看商品详情
    goprizeInt: function (e) {
      this.$router.push({ path: '/prize/prizeint?id=' + e })
    },
    goInt: function (id) {
      this.$router.push({path: '/store/stroeint?storeId=' + id})
    },
    // 关闭弹窗
    colseJoin: function () {
      this.close = false
    },
    getData: function (e) {
    // 获取家乡游戏数据
      this.$http.post(this.$store.state.postUrl + '/Api/App/getHomeGameLists', {'ssAuth': this.ssAuth, 'gzh_code': this.gzhCode, 'page': this.page, 'pageSize': 10}, {emulateJSON: true})
      .then(function (res) {
        if (res.body.data.length > 0) {
          for (let i = 0; i < res.body.data.length; i++) {
            this.gameArr.push(res.body.data[i])
          }
          // 判断是否还有数据
          if (res.body.pageInfo.more === 0) {
            this.loadings = false
            this.loading = true
            this.nomore = true
          } else {
            this.loading = false
          }
        } else {
          this.nomore = false
          this.loadings = false
          this.dataLength = true
        }
      })
    },
    // 执行底部加载
    loadMore: function () {
      this.page++
      this.loading = true
      setTimeout(() => {
        this.getData()
      }, 2500)
    },
    getBanner: function () {
      // 获取轮播数据
      this.$http.post(this.$store.state.postUrl + '/Api/SSPT/advertisementImg', {'ssAuth': this.ssAuth, 'gzh_code': this.gzhCode, 'position': 1}, {emulateJSON: true})
      .then(function (res) {
        if (res.body.code === 10000) {
          this.items = res.body.data
        }
      })
    },
    getGao: function () {
      // 获取轮播数据
      this.$http.post(this.$store.state.postUrl + '/Api/App/getAppAdv', {'position': 5}, {emulateJSON: true})
      .then(function (res) {
        console.log(res)
        if (res.body.code === 10000) {
          this.indexGao = res.body.data
        }
      })
    },
    getShang: function () {
    // 获取推荐商品
      this.$http.post(this.$store.state.postUrl + '/Api/Mall/tjGoods', {'gzh_code': this.gzhCode}, {emulateJSON: true})
      .then(function (res) {
        if (res.body.code === 10000) {
          this.shangNum = res.body.data.length
          this.goods = res.body.data
        }
      })
    },
    // 获取推荐店铺
    getDian: function () {
      this.$http.post(this.$store.state.postUrl + '/Api/Store/tjStore', {'gzh_code': this.gzhCode, 'position': 1, 'page': 1, 'pageSize': 3, 'longitude': this.jingweidu.longitude, 'latitude': this.jingweidu.latitude}, {emulateJSON: true})
      .then(function (res) {
        if (res.body.code === 10000) {
          this.dianNum = res.body.data.length
          for (let i = 0; i < res.body.data.length; i++) {
            if (res.body.data[i].distance >= 1000) {
              var kms = res.body.data[i].distance / 1000
              res.body.data[i].distance = kms.toFixed(2) + 'km'
            } else {
              res.body.data[i].distance = res.body.data[i].distance + 'm'
            }
          }
          this.shoparrs = res.body.data
        }
      })
    },
    // 截取地址栏的方法
    GetQueryString: function (name) {
      var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)')
      var r = window.location.search.substr(1).match(reg)
      if (r !== null) return unescape(r[2]); return null
    },
    // 获取用户信息
    getUserdata: function () {
      this.$http.post(this.$store.state.postUrl + '/Api/UserInfo/baseInfo', {'ssAuth': this.$store.state.ssAuth}, {emulateJSON: true})
      .then(function (res) {
        if (res.body.code === 10000) {
          this.$store.state.userPhone = res.body.data.isBindPhone // 是否绑定手机
          this.$store.state.isBankCard = res.body.data.isBankCard // 是否绑定银行卡
          this.$store.state.isAgent = res.body.data.isAgent // 是否成为代理
          this.$store.state.gzhCodes = res.body.data.gzhCodes // 公众号数组
          this.$store.state.isHavePass = res.body.data.isHavePass // 是否设置过密码
          this.wgpic = res.body.data.headImg
          sessionStorage.wgPic = res.body.data.headImg
          sessionStorage.wgName = res.body.data.nickName
          this.wgname = res.body.data.nickName
        }
      })
    },
    // 跳转广告
    goBanner: function (type, id, url) {
      if (type === 4 || type === 5) {
        this.$router.push({ path: '/store/stroeint?storeId=' + id })
      } else if (type === 2) {
        this.$router.push({ path: '/prize/prizeint?id=' + id })
      } else if (type === 3) {
        window.location.href = url
      }
    },
    // 启动游戏
    goGame: function (code) {
    //   if (navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)) {
    //     var loadDateTime = new Date()
    //     window.setTimeout(function () {
    //       var timeOutDateTime = new Date()
    //       if (timeOutDateTime - loadDateTime < 5000) {
    //         window.location = ''
    //       } else {
    //         window.close()
    //       }
    //     }, 25)
    //     window.location = 'com.tencent.tmgp.QPHeBei'
    //   } else if (navigator.userAgent.match(/android/i)) {
    //     var state = null
    //     try {
    //       state = window.open('com.tencent.tmgp.QPHeBei', '_blank')
    //     } catch (e) {}
    //     if (state) {
    //       window.close()
    //     } else {
    //       window.location = 'http://lecong.oss-cn-beijing.aliyuncs.com/game/QPHeBei16110723.apk'
    //     }
    //   }
    // }
      var ua = window.navigator.userAgent.toLowerCase()
      if (ua.match(/MicroMessenger/i)) {
        if (ua.match(/MicroMessenger/i)[0] === 'micromessenger') {
          this.popupVisible = true
        }
      } else {
        window.location = code + '://'
      }
    },
    // 验证时间戳
    shijianchuo: function () {
      this.$store.commit('increment')
      if (this.$store.state.shijianState === 1) {
        this.$http.post(this.$store.state.postUrl + '/Api/App/getWechatTicket', {}, {emulateJSON: true})
        .then(function (res) {
          this.$store.state.shijianc = res.body.data.create_time
          this.$store.state.ticket = res.body.data.ticket
          this.$store.state.shijianState = 0
        })
      }
    }
  },
  activated () {
  }
}
</script>
