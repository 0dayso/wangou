<style scoped>
    .swiper-container{
    height: 8.533rem;
  }
  .swiper-slide {
    background-repeat: no-repeat;
    background-size: 100% 8.533rem;
  }
  .aui-list{
    background-color:transparent;
  }
  .aui-list .aui-list-item-inner{
    padding-left: 0.213rem;
    border:0;
  }
   .aui-list .aui-list-item-text{
    font-size: 0.746rem;
  }
  .aui-list .aui-list-item-title{
    font-size: 0.64rem;
    margin-top: 0.32rem;
    font-weight: 700;
  }
  .aui-card-list-user-info{
    font-size: 0.533rem;
    color: #999;
    margin-top: 0.113rem;
  }
  .aui-list .food_dizhi{
    font-size: 0.533rem;
    color: #999;
    font-weight: 400;
  }
  .aui-list-item-right{
    font-size: 0.533rem;
    color: #999;
    margin-top: 0.32rem;
  } 
  .tuijianbg{
    background:none !important;
    border-radius:0!important;
    padding:0!important;
    height:auto!important;
  }
  .aui-col-xs-4{
    height: 4.906rem;
    text-align: center;
  }
  .aui-col-xs-4 .aui-4img{
    width: 100%;
    height: 3.2rem;
    background-repeat: no-repeat;
    background-size: 100%  3.2rem;
  }
  .aui-row-padded .aui-4a{
    font-size: 0.64rem;
    color: #333333;
    display: block;
    margin:0.426rem auto;
  }
  .aui-row-padded{
    padding: 0 0.853rem;
  }
  .aui-tui{
    width: 4.266rem;
    line-height: 2.133rem;
    position: relative;
    font-size: 0.64rem;
    color: #666666;
    text-align: center;
    margin:0 auto;
  }
  .delauipadding{
    padding: 0!important;
  }
  .aui-card-list{
    margin-bottom: 0;
    background-color: transparent;
  }
  .aui-heng{
    width: 1.173rem;
    height: 0.05rem;
    background: #cccccc;
    position: absolute;
    left: -1.493rem;
    top: 50%;
    margin-top: -0.0107rem;
  }
  .heng2 {
    width: 1.173rem;
    height: 0.05rem;
    background: #cccccc;
    position: absolute;
    right: -1.493rem;
    top: 50%;
    margin-top: -0.0107rem;
  }
  .tuijianbg{
    background: #fff;
  }
  .aui-timeline-item{
  }
  .commodity_box{
    height: 12.8rem;
    background: #fff;
  }
  .aui-list .aui-list-item{
    padding-left: 0.426rem;
  }
  .aui-shops-header{
    width: 3.2rem;
  }
  .aui-list .aui-list-item-media{
    width:auto;
    padding: 0.64rem 0;
    padding-right: 0.533rem;
  }
  .aui-content .aui-media-list{
    background-image: none;
  }
  .aui-list .aui-list-item{
    background-size: 0;
    padding:0 0.64rem;
  }
  .aui-list-item .aui-media-list-item-inner{
    border-bottom: 0.05rem solid #eeeeee;
  }
  .location_img{
    display: inline-block;
    width: 0.5333rem;
    height: 0.64rem;
    background: url(../assets/index/dizhi.png);
    background-size: contain;
    background-repeat: no-repeat;
    margin-right: 0.213rem;
  }
  .up_more{
    width: 100%;
    height: 1.92rem;
    color: #cccccc;
    line-height: 1.92rem;
    text-align: center;
    font-size: 0.534rem;
  }
  .advertisement{
    width: 100%;
    height: 6.882rem;
    background: #53c7c4;
    position: relative;
  }
  .advertisement_border{
    width: 13.866rem;
    height: 4.809rem;
    border:0.05rem solid #fff;
    position: absolute;
    left: 50%;
    margin-left: -6.933rem;
    top: 50%;
    margin-top: -2.4045rem;
    padding: 0.384rem;
  }
  .advertisement_border .txt{
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.8);
    overflow: hidden;
    text-align: center;
  }
  .txt .txt1{
    margin-top: 1.066rem;
    color: #333333;
    letter-spacing:0.32rem;
    font-weight: 600;
  }
  .txt .txt2{
    margin:0.226rem auto 0;
    width: 4.266rem;
    color: #333333;
    font-size: 0.64rem;
    text-align: center;
    letter-spacing:0.106rem;
    position: relative;
  }
  .advertisement_heng,.advertisement_heng1{
    width: 0.64rem;
    height: 0.05rem;
    background: #333;
    position: absolute;
    top: 50%;
    margin-top:-0.025rem;
  }
  .advertisement_heng{
    left: -0.64rem;
  }
  .advertisement_heng1{
    right: -0.64rem;
  }
  .start,.start0{
    width: 0.64rem;
    height: 0.64rem;
    margin-right: 0.106rem;
    float: left;
    background-size: cover;
    background-image: url(../assets/store/start.png);
    background-repeat: no-repeat;
  }
  .start0{
      background-image: url(../assets/store/start1.png);
  }
  .start2{
    background-image: url(../assets/store/start0.png);
  }
  .dange{
    height: 6.4rem;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  /*清除bgimg*/
  .aui-list.aui-media-list{
    background-image: none;
  }
  .aui-list.aui-media-list li{
    background-color: #fff;
    padding: 0;
    width: 100%;
    padding:0 4%;
    margin: 0 auto;
    margin-bottom: 0.64rem;
    padding-top: 0.64rem;
  }
    /*推荐*/
  .tuijian{
    position: absolute;
    width: 1.813rem;
    height: 1.813rem;
    top: 0;
    left: 0;
    background-image: url(../assets/tuijian.png);
    background-size: 100%;
  }
  /*评分*/
.score{
  color: #f5a623;
  margin-left: 0.32rem; 
}
</style>
<style>
  .swipers .swiper-pagination-bullet{
    width: 0.32rem;
    height:0.32rem;
    background: #999;
    opacity: 1;
    transition:all 0.2s;
  }
  .swipers span.swiper-pagination-bullet.swiper-pagination-bullet-active{
    width: 0.64rem;
    height: 0.32rem;
    background-color: #50e3c2!important;
    border-radius: 0.15rem;
  }
</style>
<template>
  <div id="index">
  <div v-title data-title="店铺">
  </div>
<!-- 底部     -->
  <componentName></componentName>
      <!-- 轮播图 -->
      <div class="swipers">
        <swiper  :options="swiperOption"  ref="mySwiper">
            <swiper-slide v-for="item in items">
              <img :src="item.imgUrl" @click="goBanners(item.type, item.returnId, item.webUrl)">
            </swiper-slide> 
              <!-- 这是轮播的小圆点 -->  
            <div class="swiper-pagination" slot="pagination"></div>             
        </swiper> 
      </div>
        <!-- 推荐商铺 -->
        <div class="aui-timeline-item">
                <div class="aui-timeline-item-inner">
                      <div class="aui-card-list tui-v">
                        <!-- 模块标题 -->
                        <div class="aui-tui aui-shops-header">
                          <div class="aui-heng"></div>推荐商铺<div class="heng2"></div>
                        </div>
                      </div>
                  <div class="aui-row">
                    <ul class="aui-list aui-media-list">
                      <li class="aui-list-item " v-for='item in shoparr' v-on:click="goInt(item.store_id)">
                          <div class="aui-card-list-content dange" v-bind:style="{'background-image':'url('+item.logo+')'}">
                            <div class="tuijian" v-if="item.top==1"></div>
                          </div>
                          <div class="aui-list-item-inner">
                            <div class="aui-list-item-text">
                               <div class="aui-list-item-title"><span>{{item.name}}</span></div>
                            </div>
                            <!-- 评论星星 -->
                            <div class="aui-card-list-user-info">
                              <div class="start" :class="item.score < 1 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 2 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 3 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 4 ? 'start' : 'start2'"></div><div class="start" :class="item.score < 5 ? 'start' : 'start2'"></div>
                              <span class="score">{{item.score}}分</span><span> &nbsp;&nbsp;¥{{item.equally_price}}/人</span>
                            </div>
                            <div class="aui-list-item-text">
                              <div class="aui-list-item-title food_dizhi"><i class='location_img'></i>{{item.address}}</div>
                              <div class="aui-list-item-right">{{item.distance}}</div>
                            </div>
                          </div>
                      </li>
                    </ul>
                    <div class="up_more">没有更多了</div>
                  </div>
                </div>
        </div>   
  </div>
</template>
<script>
import '../../static/css/aui.css'
import { swiper, swiperSlide } from 'vue-awesome-swiper'
export default {
  components: {
    swiper,
    swiperSlide
  },
  data () {
    return {
      swiperOption: {
        notNextTick: true,
        pagination: '.swiper-pagination',
        slidesPerView: 'auto',
        centeredSlides: true,
        paginationClickable: true,
        spaceBetween: 30,
        autoplayDisableOnInteraction: false,
        autoplay: 2000,
        onSlideChangeEnd: swiper => {
          this.page = swiper.realIndex + 1
          this.index = swiper.realIndex
        }
      },
      items: [{'imgUrl': ''}],
      shoparr: [],
      // 令牌
      ssAuth: this.$store.state.ssAuth,
      // 公众号编码
      gzhCode: this.$store.state.gzhCode,
      page: 1,
      dataLength: false,
      loadings: true,
      nomore: false,
      loading: true,
      jingweidu: this.$store.state.jingweidu, // 经纬度
      scrollTop: 0
    }
  },
  computed: {
    swiper () {
      return this.$refs.mySwiper.swiper
    }
  },
  mounted () {
    this.swiper.slideTo(0, 0, false)
    this.getBanner()
    this.getDian()
  },
  // 查看详情 返回刚才的位置
  deactivated () {
    this.scrollTop = document.documentElement.scrollTop || document.body.scrollTop
  },
  activated () {
    window.scrollTo(0, this.scrollTop)
  },
  methods: {
    goInt: function (id) {
      this.$router.push({path: '/store/stroeint?storeId=' + id})
    },
    getBanner: function () {
      // 获取轮播数据
      this.$http.post(this.$store.state.postUrl + '/Api/SSPT/advertisementImg', {'ssAuth': this.ssAuth, 'gzh_code': this.gzhCode, 'position': 3}, {emulateJSON: true})
      .then(function (res) {
        if (res.body.code === 10000) {
          this.items = res.body.data
        }
      })
    },
    // 执行底部加载
    loadMore: function () {
      this.page++
      this.loading = true
      setTimeout(() => {
        this.getDian()
      }, 2500)
    },
    // 获取店铺
    getDian: function () {
      this.$http.post(this.$store.state.postUrl + '/Api/Store/tjStore', {'gzh_code': this.gzhCode, 'position': 2, 'page': this.page, 'pageSize': 10, 'longitude': this.jingweidu.longitude, 'latitude': this.jingweidu.latitude}, {emulateJSON: true})
      .then(function (res) {
        console.log(res)
        if (res.body.code === 10000) {
          for (let i = 0; i < res.body.data.length; i++) {
            if (res.body.data[i].distance >= 1000) {
              var kms = res.body.data[i].distance / 1000
              res.body.data[i].distance = kms.toFixed(2) + 'km'
            } else {
              res.body.data[i].distance = res.body.data[i].distance + 'm'
            }
            this.shoparr.push(res.body.data[i])
          }
          // 判断是否还有数据
          if (res.body.data.length > 0) {
            if (res.body.pageInfo.more === 0) {
              this.loadings = false
              this.loading = true
              this.nomore = true
            } else {
              this.loading = false
            }
          } else {
            this.nomore = false
            this.loadings = false
            this.dataLength = true
          }
        }
      })
    },
    // 跳转广告
    goBanners: function (type, id, url) {
      if (type === 4 || type === 5) {
        this.$router.push({ path: '/store/stroeint?storeId=' + id })
      } else if (type === 2) {
        this.$router.push({ path: '/prize/prizeint?id=' + id })
      } else if (type === 3) {
        window.location.href = url
      }
    },
    // 验证时间戳
    shijianchuo: function () {
      this.$store.commit('increment')
      if (this.$store.state.shijianState === 1) {
        this.$http.post(this.$store.state.postUrl + '/Api/App/getWechatTicket', {}, {emulateJSON: true})
        .then(function (res) {
          this.$store.state.shijianc = res.body.data.create_time
          this.$store.state.ticket = res.body.data.ticket
          this.$store.state.shijianState = 0
        })
      }
    }
  }
}
</script>

